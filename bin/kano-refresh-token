#!/usr/bin/env python3
#
# Copyright (C) 2019 Kano Computing Ltd.
# License: http://www.gnu.org/licenses/gpl-2.0.txt GNU GPL v2
#
# kano-refresh-token
#
# Python3 script to refresh the Kano World login token, using the new API.
#

import mercury
import os
import sys

from kano.logging import logger


def test_refresh():
    # Not implemented yet
    pass


if __name__ == '__main__':

    rc = 1

    # TODO: add docopt, move out code into a function, implement a test option
    logger.info('accessing mercury KanoWorld')
    w = mercury.KanoWorld()
    logged_in = w.is_logged_in(True)
    if logged_in:
        logger.info('user is logged in, refreshing the token')
        success = w.refresh_token(w.token, True)
        if success:
            rc = 0
            logger.info('new token: {}'.format(w.token))
        else:
            logger.error('error refreshing token')
    else:
        logger.info('user is not logged in, nothing to do')

    sys.exit(rc)
